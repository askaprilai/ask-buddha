<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ask Buddha - Modern Life Coach</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .container {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            width: 100%;
            max-width: 1000px;
            padding: 40px;
            backdrop-filter: blur(10px);
        }

        .donation-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }

        .donation-content {
            background: white;
            border-radius: 20px;
            padding: 40px;
            max-width: 500px;
            width: 90%;
            text-align: center;
            position: relative;
        }

        .close-modal {
            position: absolute;
            top: 15px;
            right: 20px;
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: #999;
        }

        .donation-badge {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 10px 20px;
            border-radius: 25px;
            display: inline-block;
            margin-bottom: 20px;
            font-weight: bold;
        }

        .donation-options {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin: 30px 0;
        }

        .donation-option {
            padding: 25px;
            border-radius: 15px;
            border: 2px solid #e2e8f0;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
            background: linear-gradient(135deg, rgba(255,255,255,0.9) 0%, rgba(249,250,251,0.9) 100%);
        }

        .donation-option:hover {
            border-color: #667eea;
            transform: translateY(-2px);
        }

        .donation-option.selected {
            border-color: #667eea;
            background: linear-gradient(135deg, rgba(102, 126, 234, 0.1) 0%, rgba(118, 75, 162, 0.1) 100%);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.2);
        }

        .option-icon {
            font-size: 2.5em;
            margin-bottom: 15px;
        }

        .option-price {
            font-size: 2em;
            font-weight: bold;
            color: #4a5568;
            margin-bottom: 5px;
        }

        .option-frequency {
            color: #718096;
            margin-bottom: 10px;
        }

        .option-benefit {
            color: #059669;
            font-weight: bold;
        }

        .paypal-btn {
            background: #0070ba;
            color: white;
            border: none;
            padding: 15px 40px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 18px;
            font-weight: 600;
            width: 100%;
            margin: 20px 0;
            transition: transform 0.2s ease;
        }

        .paypal-btn:hover {
            transform: translateY(-2px);
            background: #005ea6;
        }

        .usage-counter {
            background: rgba(255, 193, 7, 0.1);
            border: 1px solid #ffc107;
            padding: 10px 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            text-align: center;
            color: #856404;
        }

        .upgrade-banner {
            background: linear-gradient(135deg, #ff6b6b 0%, #ee5a24 100%);
            color: white;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
            text-align: center;
        }

        .upgrade-btn {
            background: white;
            color: #ee5a24;
            border: none;
            padding: 8px 20px;
            border-radius: 20px;
            cursor: pointer;
            font-weight: bold;
            margin-top: 10px;
        }

        .header {
            text-align: center;
            margin-bottom: 40px;
        }

        .buddha-icon {
            font-size: 4em;
            margin-bottom: 10px;
            display: block;
            animation: gentle-pulse 3s ease-in-out infinite;
        }

        @keyframes gentle-pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        h1 {
            color: #4a5568;
            font-size: 2.5em;
            margin-bottom: 10px;
            font-weight: 300;
        }

        .subtitle {
            color: #718096;
            font-size: 1.2em;
            margin-bottom: 30px;
        }

        .value-prop {
            background: linear-gradient(135deg, rgba(102, 126, 234, 0.1) 0%, rgba(118, 75, 162, 0.1) 100%);
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 30px;
            text-align: center;
            border-left: 4px solid #667eea;
        }

        .value-prop-text {
            color: #4a5568;
            font-weight: 500;
            font-size: 1.1em;
        }

        .quick-problems {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 30px;
        }

        .problem-btn {
            background: rgba(255, 255, 255, 0.8);
            border: 1px solid #e2e8f0;
            padding: 15px;
            border-radius: 12px;
            cursor: pointer;
            font-size: 0.9em;
            transition: all 0.2s ease;
            text-align: center;
        }

        .problem-btn:hover {
            background: #667eea;
            color: white;
            border-color: #667eea;
            transform: translateY(-2px);
        }

        .problem-emoji {
            display: block;
            font-size: 1.5em;
            margin-bottom: 8px;
        }

        .chat-container {
            background: #f7fafc;
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 20px;
            min-height: 400px;
            max-height: 500px;
            overflow-y: auto;
            border: 1px solid #e2e8f0;
        }

        .message {
            margin-bottom: 25px;
            display: flex;
            align-items: flex-start;
            gap: 15px;
            opacity: 0;
            animation: fadeInUp 0.5s ease forwards;
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .message.user {
            flex-direction: row-reverse;
        }

        .message-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2em;
            flex-shrink: 0;
        }

        .message.buddha .message-avatar {
            background: linear-gradient(135deg, #ffd89b 0%, #19547b 100%);
            color: white;
        }

        .message.user .message-avatar {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .message-content {
            background: white;
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            max-width: 75%;
            line-height: 1.6;
            position: relative;
        }

        .message.user .message-content {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .buddha-quote {
            background: rgba(255, 216, 155, 0.2);
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 15px;
            border-left: 3px solid #ffd89b;
            font-style: italic;
            color: #4a5568;
        }

        .modern-translation {
            background: rgba(102, 126, 234, 0.1);
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 15px;
            border-left: 3px solid #667eea;
            font-weight: 500;
            color: #4a5568;
        }

        .action-plan {
            background: rgba(34, 197, 94, 0.1);
            padding: 15px;
            border-radius: 10px;
            border-left: 3px solid #22c55e;
        }

        .action-plan h4 {
            color: #15803d;
            margin-bottom: 10px;
            font-size: 1em;
        }

        .action-step {
            display: flex;
            align-items: flex-start;
            margin-bottom: 8px;
            color: #374151;
        }

        .step-number {
            background: #22c55e;
            color: white;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.8em;
            font-weight: bold;
            margin-right: 10px;
            flex-shrink: 0;
        }

        .message-time {
            font-size: 0.8em;
            color: #a0aec0;
            margin-top: 10px;
        }

        .message.user .message-time {
            color: rgba(255, 255, 255, 0.7);
        }

        .input-container {
            display: flex;
            gap: 15px;
            align-items: flex-end;
            position: relative;
        }

        .voice-input-container {
            position: relative;
            flex: 1;
        }

        .mic-button {
            position: absolute;
            right: 15px;
            top: 50%;
            transform: translateY(-50%);
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border: none;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
            color: white;
            transition: all 0.3s ease;
            box-shadow: 0 2px 8px rgba(102, 126, 234, 0.3);
        }

        .mic-button:hover {
            transform: translateY(-50%) scale(1.1);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
        }

        .mic-button.recording {
            background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
            animation: pulse-recording 1.5s infinite;
        }

        @keyframes pulse-recording {
            0%, 100% {
                box-shadow: 0 2px 8px rgba(239, 68, 68, 0.3);
            }
            50% {
                box-shadow: 0 4px 16px rgba(239, 68, 68, 0.6);
            }
        }

        .voice-status {
            position: absolute;
            bottom: -25px;
            left: 0;
            right: 0;
            text-align: center;
            font-size: 12px;
            color: #667eea;
            font-weight: 500;
        }

        #questionInput {
            width: 100%;
            padding: 18px 70px 18px 24px;
            border: 2px solid #e2e8f0;
            border-radius: 25px;
            font-size: 16px;
            outline: none;
            transition: border-color 0.3s ease;
            resize: none;
            min-height: 60px;
            max-height: 140px;
            font-family: inherit;
            line-height: 1.5;
        }

        #questionInput:focus {
            border-color: #667eea;
        }

        #askButton {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            transition: transform 0.2s ease;
            min-width: 120px;
        }

        #askButton:hover:not(:disabled) {
            transform: translateY(-2px);
        }

        #askButton:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }

        .welcome-message {
            text-align: center;
            color: #718096;
            font-style: italic;
            margin: 40px 0;
        }

        .typing-indicator {
            display: none;
            align-items: center;
            gap: 10px;
            color: #718096;
            font-style: italic;
        }

        .typing-dots {
            display: flex;
            gap: 3px;
        }

        .typing-dots span {
            width: 6px;
            height: 6px;
            background: #718096;
            border-radius: 50%;
            animation: typing 1.4s infinite;
        }

        .typing-dots span:nth-child(2) {
            animation-delay: 0.2s;
        }

        .typing-dots span:nth-child(3) {
            animation-delay: 0.4s;
        }

        @keyframes typing {
            0%, 60%, 100% {
                transform: translateY(0);
                opacity: 0.4;
            }
            30% {
                transform: translateY(-10px);
                opacity: 1;
            }
        }

        @media (max-width: 768px) {
            .container {
                padding: 20px 15px;
                margin: 10px;
                max-width: 100%;
            }

            .donation-content {
                padding: 25px 15px;
                width: 95%;
            }

            .donation-options {
                grid-template-columns: 1fr;
                gap: 15px;
            }

            h1 {
                font-size: 2em;
            }

            .subtitle {
                font-size: 1em;
            }

            .buddha-icon {
                font-size: 3em;
            }

            .message-content {
                max-width: 90%;
            }

            .input-container {
                flex-direction: column;
                align-items: stretch;
                gap: 10px;
            }

            #askButton {
                margin-top: 0;
                padding: 15px;
                font-size: 16px;
            }

            #questionInput {
                font-size: 16px;
                padding: 18px 60px 18px 20px;
                min-height: 58px;
                max-height: 130px;
            }

            .mic-button {
                width: 36px;
                height: 36px;
                right: 12px;
                font-size: 14px;
            }

            .quick-problems {
                grid-template-columns: 1fr;
                gap: 10px;
            }

            .problem-btn {
                padding: 15px;
                font-size: 0.9em;
            }

            .chat-container {
                padding: 20px;
                max-height: 400px;
            }

            .value-prop {
                padding: 15px;
                margin-bottom: 20px;
            }

            .value-prop-text {
                font-size: 1em;
            }

            /* Mobile-friendly resources section */
            footer {
                padding: 20px 0 !important;
            }
            
            footer > div {
                padding: 0 15px !important;
            }
            
            .resources-grid {
                display: block !important;
                grid-template-columns: none !important;
            }

            .resource-card {
                padding: 15px !important;
                margin-bottom: 15px !important;
                display: block !important;
                width: 100% !important;
                box-sizing: border-box !important;
            }

            /* Better touch targets for mobile */
            .donation-option {
                padding: 20px;
                margin-bottom: 10px;
            }

            .paypal-btn {
                padding: 18px 25px;
                font-size: 16px;
            }

            /* Mobile donation modal */
            .donation-modal {
                padding: 10px;
                align-items: flex-start;
                padding-top: 20px;
            }

            .donation-content {
                width: 100%;
                max-width: 100%;
                margin: 0;
                max-height: 90vh;
                overflow-y: auto;
            }

            .donation-options {
                grid-template-columns: 1fr;
                gap: 15px;
            }

            .donation-option {
                padding: 20px 15px;
            }

            .option-price {
                font-size: 1.5em;
            }

            .option-benefit {
                font-size: 0.9em;
            }

            #paymentButtons {
                flex-direction: column;
                gap: 12px;
            }

            .paypal-btn {
                padding: 18px 15px;
                font-size: 15px;
            }
        }

        @media (max-width: 480px) {
            .container {
                padding: 15px 10px;
                margin: 5px;
            }

            h1 {
                font-size: 1.8em;
            }

            .buddha-icon {
                font-size: 2.5em;
            }

            .problem-btn {
                padding: 12px;
                font-size: 0.85em;
            }

            .chat-container {
                padding: 15px;
                min-height: 300px;
                max-height: 350px;
            }

            .message-content {
                max-width: 95%;
                padding: 15px;
            }

            .action-step {
                flex-direction: column;
                align-items: flex-start;
                gap: 5px;
            }

            .step-number {
                margin-right: 0;
                margin-bottom: 5px;
            }

            /* Extra small mobile donation modal */
            .donation-modal {
                padding: 5px;
                padding-top: 10px;
            }

            .donation-content {
                padding: 20px 15px;
                border-radius: 15px;
            }

            .donation-badge {
                font-size: 0.9em;
                padding: 8px 16px;
            }

            .donation-content h2 {
                font-size: 1.3em;
            }

            .donation-content p {
                font-size: 0.9em;
            }

            .option-icon {
                font-size: 2em;
            }

            .option-price {
                font-size: 1.3em;
            }

            .option-frequency,
            .option-benefit {
                font-size: 0.85em;
            }

            .paypal-btn {
                padding: 16px 12px;
                font-size: 14px;
            }

            .close-modal {
                top: 10px;
                right: 15px;
                font-size: 20px;
            }
        }

        .hidden {
            display: none !important;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <span class="buddha-icon">🧘‍♂️</span>
            <h1>Ask Buddha</h1>
            <p class="subtitle">Ancient Wisdom for Modern Problems</p>
        </div>

        <!-- Usage Counter for Free Users -->
        <div class="usage-counter" id="usageCounter" style="display: none;">
            <strong>Free Wish:</strong> <span id="messagesLeft">1</span> question remaining
        </div>

        <!-- Donation Banner -->
        <div class="upgrade-banner" id="upgradeBanner" style="display: none;">
            <div><strong>🙏 You've used your free question!</strong></div>
            <div>Please consider making a donation to continue receiving Buddha's wisdom</div>
            <button class="upgrade-btn" onclick="showDonationModal()">Make a Donation</button>
        </div>

        <div class="value-prop">
            <div class="value-prop-text">
                Get Buddhist insights with practical action steps you can actually use in real life
            </div>
        </div>

        <div class="quick-problems">
            <button class="problem-btn" onclick="askProblem('My boss is toxic and making my life miserable')">
                <span class="problem-emoji">😤</span>
                Toxic Boss
            </button>
            <button class="problem-btn" onclick="askProblem('I keep getting ghosted on dating apps')">
                <span class="problem-emoji">👻</span>
                Dating Problems
            </button>
            <button class="problem-btn" onclick="askProblem('Everyone on social media looks happier than me')">
                <span class="problem-emoji">📱</span>
                Social Media Anxiety
            </button>
            <button class="problem-btn" onclick="askProblem('I am always stressed about money')">
                <span class="problem-emoji">💸</span>
                Money Stress
            </button>
            <button class="problem-btn" onclick="askProblem('My family does not understand me')">
                <span class="problem-emoji">👨‍👩‍👧</span>
                Family Drama
            </button>
            <button class="problem-btn" onclick="askProblem('I feel stuck in life and do not know what to do')">
                <span class="problem-emoji">🔄</span>
                Feeling Stuck
            </button>
        </div>

        <div class="chat-container" id="chatContainer">
            <div class="welcome-message">
                What's bothering you today? I'll give you ancient wisdom with modern, practical steps you can actually use.
            </div>
        </div>

        <div class="typing-indicator" id="typingIndicator">
            <div class="message-avatar" style="background: linear-gradient(135deg, #ffd89b 0%, #19547b 100%); color: white;">🧘‍♂️</div>
            <div>Buddha is crafting your action plan...</div>
            <div class="typing-dots">
                <span></span>
                <span></span>
                <span></span>
            </div>
        </div>

        <div class="input-container">
            <div class="voice-input-container">
                <textarea id="questionInput" placeholder="What's your real-life problem? (work stress, relationship issues, money worries, family drama, etc.)" rows="1"></textarea>
                <button id="micButton" class="mic-button" onclick="toggleVoiceInput()" title="Click to speak your question">
                    🎤
                </button>
                <div id="voiceStatus" class="voice-status" style="display: none;"></div>
            </div>
            <button id="askButton" onclick="askBuddha()">Get Wisdom</button>
        </div>
        
        <!-- Donation Support Button -->
        <div style="text-align: center; margin-top: 20px;">
            <button onclick="showDonationModal()" style="background: linear-gradient(135deg, #dc2626 0%, #b91c1c 100%); color: white; border: none; padding: 12px 24px; border-radius: 25px; cursor: pointer; font-size: 16px; font-weight: 600; box-shadow: 0 4px 12px rgba(220, 38, 38, 0.3); transition: transform 0.2s ease;">
                🙏 Support Buddha's Wisdom
            </button>
        </div>

        <!-- Buddhist Resources Section (moved here) -->
        <div style="margin-top: 40px; padding-top: 30px; border-top: 1px solid #e2e8f0;">
            <h3 style="color: #2d3748; margin-bottom: 20px; font-size: 1.3em; text-align: center;">🙏 Authentic Buddhist Resources</h3>
            
            <div style="max-width: 600px; margin: 0 auto;">
                <div style="background: white; padding: 20px; border-radius: 10px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); margin-bottom: 20px;">
                    <h4 style="color: #2d3748; margin-bottom: 10px;">📜 Early Buddhism</h4>
                    <a href="https://suttacentral.net" target="_blank" style="color: #4299e1; text-decoration: none; font-weight: 600;">SuttaCentral.net</a>
                    <p style="font-size: 0.9em; color: #6b7280; margin: 5px 0 0 0;">Pali Canon & early texts</p>
                </div>
                
                <div style="background: white; padding: 20px; border-radius: 10px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); margin-bottom: 20px;">
                    <h4 style="color: #2d3748; margin-bottom: 10px;">🏔️ Tibetan Buddhism</h4>
                    <a href="https://84000.co" target="_blank" style="color: #4299e1; text-decoration: none; font-weight: 600;">84000.co</a>
                    <p style="font-size: 0.9em; color: #6b7280; margin: 5px 0 0 0;">Translated Tibetan texts</p>
                </div>
                
                <div style="background: white; padding: 20px; border-radius: 10px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); margin-bottom: 20px;">
                    <h4 style="color: #2d3748; margin-bottom: 10px;">🧘 Theravada Teachings</h4>
                    <a href="https://www.dhammatalks.org" target="_blank" style="color: #4299e1; text-decoration: none; font-weight: 600;">DhammaTalks.org</a>
                    <p style="font-size: 0.9em; color: #6b7280; margin: 5px 0 0 0;">Thanissaro Bhikkhu's teachings</p>
                </div>
                
                <div style="background: white; padding: 20px; border-radius: 10px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); margin-bottom: 20px;">
                    <h4 style="color: #2d3748; margin-bottom: 10px;">📖 Study Resources</h4>
                    <a href="https://www.accesstoinsight.org" target="_blank" style="color: #4299e1; text-decoration: none; font-weight: 600;">AccessToInsight.org</a>
                    <p style="font-size: 0.9em; color: #6b7280; margin: 5px 0 0 0;">Comprehensive Buddhist library</p>
                </div>
            </div>
            
            <!-- Collapsible Disclaimer -->
            <div style="text-align: center; margin-top: 30px;">
                <button onclick="toggleDisclaimer()" id="disclaimerToggle" style="background: rgba(255, 193, 7, 0.1); border: 1px solid #ffc107; padding: 12px 24px; border-radius: 25px; cursor: pointer; font-size: 14px; color: #856404;">
                    <span>⚠️ AI Disclaimer & Transparency</span>
                    <span id="disclaimerIcon" style="margin-left: 8px;">▼</span>
                </button>
                
                <div id="disclaimerContent" style="display: none; margin-top: 20px; padding: 25px; background: rgba(255, 193, 7, 0.05); border: 1px solid #ffc107; border-radius: 10px; font-size: 0.9em; color: #856404; line-height: 1.6; text-align: left; max-width: 600px; margin-left: auto; margin-right: auto;">
                    <div style="margin-bottom: 20px;">
                        <strong>🤖 AI-Generated Content:</strong> All responses are generated by artificial intelligence based on Buddhist principles. This is <strong>not</strong> authentic Dharma transmission from qualified teachers.
                    </div>
                    <div style="margin-bottom: 20px;">
                        <strong>📚 Verification Required:</strong> As Buddhist communities emphasize: <em>"AI can literally be 100% false"</em> - always verify insights with experienced practitioners and authentic texts.
                    </div>
                    <div style="background: rgba(239, 68, 68, 0.1); padding: 15px; border-radius: 8px; border-left: 4px solid #ef4444;">
                        <strong>⚠️ Not a Spiritual Teacher:</strong> This AI cannot replace genuine Buddhist study, meditation practice, or guidance from qualified teachers. Buddhist wisdom traditionally requires human transmission within established lineages and community support.
                    </div>
                </div>
            </div>
        </div>
        
    </div>

    <!-- Donation Modal -->
    <div class="donation-modal" id="donationModal" style="display: none;">
        <div class="donation-content">
            <button class="close-modal" onclick="hideDonationModal()">×</button>
            
            <div class="donation-badge">🙏 SUPPORT BUDDHA'S WISDOM</div>
            
            <h2 style="color: #4a5568; margin-bottom: 10px;">Support Buddha's Wisdom</h2>
            <p style="color: #718096; margin-bottom: 20px;">Half your gift builds schools in the sacred land where the Buddha once walked—honoring his legacy and planting seeds of wisdom for generations to come. In return, you receive a blessing of gratitude and light.</p>
            <p style="color: #059669; font-weight: 600; margin-bottom: 30px; font-size: 0.95em;">✨ Choose your support option below</p>
            
            <div class="donation-options">
                <!-- Monthly Donation Option -->
                <div class="donation-option" onclick="selectDonationType('monthly')" id="monthlyOption">
                    <div class="option-icon">🌙</div>
                    <div class="option-price">$1</div>
                    <div class="option-frequency">monthly subscription</div>
                    <div class="option-benefit">Endless Questions. Limitless Insight.</div>
                </div>
                
                <!-- One-time Donation Option -->
                <div class="donation-option selected" onclick="selectDonationType('onetime')" id="onetimeOption">
                    <div class="option-icon">☀️</div>
                    <div class="option-price">50¢</div>
                    <div class="option-frequency">one-time donation</div>
                    <div class="option-benefit">Ask 5 Questions – No Subscription Required</div>
                </div>
            </div>
            
            <!-- PayPal Button Container -->
            <div id="paypal-button-display" style="margin: 20px 0;">
                <div id="paypal-container"></div>
            </div>

            <div id="paymentButtons" style="display: flex; flex-direction: column; gap: 10px;">
                <button class="paypal-btn" onclick="showPayPalButton()" id="donateButton">
                    🙏 Make a One-Time Donation via PayPal
                </button>
                <button class="paypal-btn" onclick="selectDonationType('monthly'); showPayPalButton();" id="subscribeButton" style="display: none; background: linear-gradient(135deg, #059669 0%, #047857 100%);">
                    🌙 Start $1 Monthly Plan
                </button>
            </div>
            
            <div style="color: #718096; font-size: 0.9em; margin-top: 15px; text-align: center;">
                Safe checkout • Your kindness sustains this offering • Deepest thanks 🙏<br>
                <span style="color: #9ca3af; font-size: 0.85em; margin-top: 5px; display: inline-block;">🔒 Payments processed securely via PayPal</span>
            </div>
        </div>
    </div>

    <script>
        // Donation and usage tracking
        let isSubscribed = localStorage.getItem('buddha_subscribed') === 'true';
        let hasOneTimeDonation = localStorage.getItem('buddha_onetime') === 'true';
        let messagesUsed = parseInt(localStorage.getItem('buddha_messages_used') || '0');
        let oneTimeMessagesUsed = parseInt(localStorage.getItem('buddha_onetime_used') || '0');
        const freeMessageLimit = 1;
        const oneTimeMessageLimit = 5;
        let selectedDonationType = 'onetime';

        const modernWisdom = {
            work: {
                toxic_boss: {
                    quote: "No one can hurt you without your permission.",
                    translation: "Your boss can be awful, but how much you let it ruin your day is up to you.",
                    actions: [
                        "Document everything: Keep records of toxic behavior in case you need HR or legal help",
                        "Set boundaries: Respond to emails only during work hours, don't engage in personal attacks",
                        "Build your exit strategy: Update your resume and start networking - you don't have to stay forever"
                    ]
                },
                overwhelmed: {
                    quote: "You have power over your mind - not outside events. Realize this, and you will find strength.",
                    translation: "Work will always be chaotic, but you can control how you respond to it.",
                    actions: [
                        "Brain dump: Write down everything on your mind for 5 minutes to clear mental clutter",
                        "Pick 3 priorities: Choose the 3 most important tasks for today and ignore the rest",
                        "Time-box urgent requests: Give yourself 15 minutes to respond, then move on"
                    ]
                }
            },
            dating: {
                ghosting: {
                    quote: "Pain is inevitable, suffering is optional.",
                    translation: "Getting ghosted hurts, but torturing yourself about it is a choice.",
                    actions: [
                        "Give yourself 24 hours: Feel bad for one day, then consciously move on",
                        "Don't take it personally: They're dealing with their own stuff - it's not about your worth",
                        "Keep your options open: Don't put all your emotional eggs in one basket until you're exclusive"
                    ]
                }
            },
            social_media: {
                comparison: {
                    quote: "Comparison is the thief of joy.",
                    translation: "Everyone posts their highlight reel while you're living your behind-the-scenes.",
                    actions: [
                        "Unfollow triggers: Mute or unfollow accounts that make you feel bad about yourself",
                        "Set phone limits: Use screen time controls to limit social media to 30 minutes per day",
                        "Reality check: Remember that posts are curated - nobody's life is actually that perfect"
                    ]
                }
            },
            money: {
                anxiety: {
                    quote: "Do not dwell in the past, do not dream of the future, concentrate the mind on the present moment.",
                    translation: "Money stress is usually about imaginary future disasters - focus on what you can control today.",
                    actions: [
                        "Calculate your actual runway: How long can you survive on current savings? It's probably longer than you think",
                        "Make one small money move today: Save $5, apply for one job, or research one side hustle",
                        "Separate wants from needs: Write down what you actually need to survive vs. what you want"
                    ]
                }
            },
            family: {
                misunderstood: {
                    quote: "Hatred does not cease by hatred, but only by love; this is the eternal rule.",
                    translation: "Fighting your family's lack of understanding with anger just creates more drama.",
                    actions: [
                        "Accept their limitations: They may never fully get you, and that's okay",
                        "Find your chosen family: Build close relationships with people who do understand you",
                        "Set loving boundaries: You can love them while protecting your emotional energy"
                    ]
                }
            },
            life: {
                stuck: {
                    quote: "A journey of a thousand miles begins with a single step.",
                    translation: "Feeling stuck means you need to take any small action - the direction matters less than movement.",
                    actions: [
                        "Make a tiny change: Do one thing differently today, even if it's taking a new route to work",
                        "List 3 experiments: Try 3 small things this week that might lead somewhere interesting",
                        "Talk to someone new: Have one conversation with someone outside your usual circle"
                    ]
                }
            }
        };

        function initializeApp() {
            updateUsageDisplay();
            checkDonationStatus();
        }

        function updateUsageDisplay() {
            const usageCounter = document.getElementById('usageCounter');
            const upgradeBanner = document.getElementById('upgradeBanner');
            
            let totalAvailableMessages = freeMessageLimit;
            let totalUsedMessages = messagesUsed;
            
            if (hasOneTimeDonation) {
                totalAvailableMessages += oneTimeMessageLimit;
                totalUsedMessages += oneTimeMessagesUsed;
            }
            
            const messagesLeft = totalAvailableMessages - messagesUsed - oneTimeMessagesUsed;

            if (isSubscribed) {
                usageCounter.style.display = 'none';
                upgradeBanner.style.display = 'none';
            } else if (messagesLeft <= 0) {
                usageCounter.style.display = 'none';
                upgradeBanner.style.display = 'block';
            } else {
                usageCounter.style.display = 'block';
                upgradeBanner.style.display = 'none';
                document.getElementById('messagesLeft').textContent = messagesLeft;
            }
        }

        function checkDonationStatus() {
            // Check URL parameters for PayPal return
            const urlParams = new URLSearchParams(window.location.search);
            if (urlParams.get('payment_status') === 'success') {
                handlePaymentSuccess();
            }
        }

        function handlePaymentSuccess() {
            if (selectedDonationType === 'monthly') {
                isSubscribed = true;
                localStorage.setItem('buddha_subscribed', 'true');
                addMessage("🎉 Thank you for your monthly donation! You now have unlimited access to Buddha's wisdom. Your support helps maintain this mindful service.", false);
            } else {
                hasOneTimeDonation = true;
                localStorage.setItem('buddha_onetime', 'true');
                addMessage("🙏 Thank you for your donation! You now have 5 additional questions. Your support means everything to us.", false);
            }
            updateUsageDisplay();
        }

        function canAskQuestion() {
            if (isSubscribed) return true;
            
            let totalUsed = messagesUsed + oneTimeMessagesUsed;
            let totalAvailable = freeMessageLimit + (hasOneTimeDonation ? oneTimeMessageLimit : 0);
            
            return totalUsed < totalAvailable;
        }

        function selectDonationType(type) {
            selectedDonationType = type;
            
            // Update UI
            document.querySelectorAll('.donation-option').forEach(option => {
                option.classList.remove('selected');
            });
            
            const donateButton = document.getElementById('donateButton');
            const subscribeButton = document.getElementById('subscribeButton');
            
            if (type === 'monthly') {
                document.getElementById('monthlyOption').classList.add('selected');
                donateButton.innerHTML = '🌙 Start $1 Monthly Plan via PayPal';
                donateButton.style.background = 'linear-gradient(135deg, #059669 0%, #047857 100%)';
                subscribeButton.style.display = 'none';
            } else {
                document.getElementById('onetimeOption').classList.add('selected');
                donateButton.innerHTML = '🙏 Make a One-Time Donation via PayPal';
                donateButton.style.background = 'linear-gradient(135deg, #0070ba 0%, #005ea6 100%)';
                subscribeButton.style.display = 'block';
            }
        }


        function hideDonationModal() {
            document.getElementById('donationModal').style.display = 'none';
        }

        function showPayPalButton() {
            // Keep the donate button visible and show PayPal button below it
            const container = document.getElementById('paypal-container');
            container.innerHTML = '';
            
            // Load appropriate PayPal button based on selection
            if (typeof paypal !== 'undefined') {
                if (selectedDonationType === 'monthly') {
                    // Monthly subscription button
                    paypal.HostedButtons({
                        hostedButtonId: "F4QWDH2XNBDCS",
                    }).render("#paypal-container");
                } else {
                    // One-time donation button
                    paypal.HostedButtons({
                        hostedButtonId: "XQMQ7DXUGQWGG",
                    }).render("#paypal-container");
                }
            }
        }

        function submitPayPalDonation() {
            // This function can be used for additional tracking if needed
        }

        function getModernResponse(question) {
            const lowerQuestion = question.toLowerCase();
            
            // Work-related problems
            if (lowerQuestion.includes('boss') && (lowerQuestion.includes('toxic') || lowerQuestion.includes('bad') || lowerQuestion.includes('awful'))) {
                return modernWisdom.work.toxic_boss;
            }
            if (lowerQuestion.includes('work') && (lowerQuestion.includes('overwhelmed') || lowerQuestion.includes('stress') || lowerQuestion.includes('too much'))) {
                return modernWisdom.work.overwhelmed;
            }
            
            // Dating problems
            if (lowerQuestion.includes('ghost') || lowerQuestion.includes('dating')) {
                return modernWisdom.dating.ghosting;
            }
            
            // Social media issues
            if (lowerQuestion.includes('social media') || lowerQuestion.includes('instagram') || lowerQuestion.includes('facebook')) {
                return modernWisdom.social_media.comparison;
            }
            
            // Money problems
            if (lowerQuestion.includes('money') || lowerQuestion.includes('broke') || lowerQuestion.includes('financial')) {
                return modernWisdom.money.anxiety;
            }
            
            // Family issues
            if (lowerQuestion.includes('family') || lowerQuestion.includes('parents')) {
                return modernWisdom.family.misunderstood;
            }
            
            // Life direction
            if (lowerQuestion.includes('stuck') || lowerQuestion.includes('lost') || lowerQuestion.includes('direction')) {
                return modernWisdom.life.stuck;
            }
            
            // Default response for other issues
            return {
                quote: "Every moment is a fresh beginning.",
                translation: "No matter what you're going through, you can start changing your situation right now.",
                actions: [
                    "Take one deep breath and ask: 'What's one small thing I can control right now?'",
                    "Write down exactly what's bothering you - sometimes clarity comes through writing",
                    "Do something kind for yourself today, even if it's just making your favorite tea"
                ]
            };
        }

        function addMessage(content, isUser = false) {
            const chatContainer = document.getElementById('chatContainer');
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${isUser ? 'user' : 'buddha'}`;
            
            const now = new Date();
            const timeString = now.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
            
            if (isUser) {
                messageDiv.innerHTML = `
                    <div class="message-avatar">🙋‍♂️</div>
                    <div class="message-content">
                        ${content}
                        <div class="message-time">${timeString}</div>
                    </div>
                `;
            } else {
                const response = getModernResponse(content);
                messageDiv.innerHTML = `
                    <div class="message-avatar">🧘‍♂️</div>
                    <div class="message-content">
                        <div class="buddha-quote">
                            "${response.quote}" - Attributed to Buddhist teachings
                        </div>
                        <div class="modern-translation">
                            <strong>In plain English:</strong> ${response.translation}
                        </div>
                        <div class="action-plan">
                            <h4>Your Action Plan:</h4>
                            ${response.actions.map((action, index) => `
                                <div class="action-step">
                                    <span class="step-number">${index + 1}</span>
                                    <span>${action}</span>
                                </div>
                            `).join('')}
                        </div>
                        <div style="background: rgba(102, 126, 234, 0.1); padding: 15px; border-radius: 10px; margin-top: 15px; border-left: 3px solid #667eea;">
                            <strong>💭</strong> Which of these steps resonates most with you? Do you have questions about implementing any of them? Or is there another aspect of your situation you'd like to explore? I'm here to help you go deeper.
                        </div>
                        <div style="background: rgba(255, 193, 7, 0.1); padding: 10px; border-radius: 8px; margin-top: 15px; font-size: 0.85em; color: #856404;">
                            <strong>📚 AI Guidance:</strong> This response is AI-generated based on Buddhist principles. For authentic Dharma study, consult qualified teachers or texts like the <a href="https://suttacentral.net" target="_blank" style="color: #856404;">Pali Canon</a> or <a href="https://84000.co" target="_blank" style="color: #856404;">Mahayana Sutras</a>.
                        </div>
                        <div class="message-time">${timeString}</div>
                    </div>
                `;
            }
            
            chatContainer.appendChild(messageDiv);
            chatContainer.scrollTop = chatContainer.scrollHeight;
            
            // Remove welcome message if it exists
            const welcomeMessage = chatContainer.querySelector('.welcome-message');
            if (welcomeMessage) {
                welcomeMessage.remove();
            }
        }

        function showTypingIndicator() {
            document.getElementById('typingIndicator').style.display = 'flex';
        }

        function hideTypingIndicator() {
            document.getElementById('typingIndicator').style.display = 'none';
        }

        function askProblem(problem) {
            document.getElementById('questionInput').value = problem;
            askBuddha();
        }

        async function askBuddha() {
            const input = document.getElementById('questionInput');
            const button = document.getElementById('askButton');
            const question = input.value.trim();
            
            if (!question) return;

            // Check if user has used their free question
            if (messagesUsed >= freeMessageLimit && !isSubscribed && !hasOneTimeDonation) {
                showDonationModal();
                return;
            }
            
            // Disable input and button
            input.disabled = true;
            button.disabled = true;
            
            // Add user message
            addMessage(question, true);
            
            // Increment usage counters BEFORE processing
            if (!isSubscribed) {
                if (messagesUsed < freeMessageLimit) {
                    messagesUsed++;
                    localStorage.setItem('buddha_messages_used', messagesUsed.toString());
                } else if (hasOneTimeDonation && oneTimeMessagesUsed < oneTimeMessageLimit) {
                    oneTimeMessagesUsed++;
                    localStorage.setItem('buddha_onetime_used', oneTimeMessagesUsed.toString());
                }
                updateUsageDisplay();
            }
            
            // Clear input
            input.value = '';
            
            // Show typing indicator
            showTypingIndicator();
            
            // Simulate thinking time
            await new Promise(resolve => setTimeout(resolve, 2000 + Math.random() * 2000));
            
            // Hide typing indicator
            hideTypingIndicator();
            
            // Calculate totals for follow-up logic BEFORE adding response
            const totalUsed = messagesUsed + oneTimeMessagesUsed;
            const totalAvailable = freeMessageLimit + (hasOneTimeDonation ? oneTimeMessageLimit : 0);

            // Add Buddha's response
            addMessage(question, false);
            
            // Re-enable input and button
            input.disabled = false;
            button.disabled = false;
            input.focus();

            // Encourage follow-up question after first answer (only if not hitting limits)
            if (messagesUsed === 1 && !isSubscribed && totalUsed < totalAvailable) {
                setTimeout(() => {
                    addMessage("💭 Which of these steps resonates most with you? Do you have questions about implementing any of them? Or is there another aspect of your situation you'd like to explore? I'm here to help you go deeper.", false);
                }, 2000);
            }
            
            // Show donation prompt if user is at limit (but not if follow-up was shown)
            else if (!isSubscribed && totalUsed === totalAvailable) {
                setTimeout(() => {
                    addMessage("🙏 You've used your free question. To continue our conversation and get more personalized guidance, please consider making a donation to support Buddha's wisdom.", false);
                }, 1000);
            }
        }

        // Auto-resize textarea
        document.getElementById('questionInput').addEventListener('input', function() {
            this.style.height = 'auto';
            this.style.height = Math.min(this.scrollHeight, 120) + 'px';
        });

        // Enter key to submit (Shift+Enter for new line)
        document.getElementById('questionInput').addEventListener('keydown', function(e) {
            if (e.key === 'Enter' && !e.shiftKey) {
                e.preventDefault();
                askBuddha();
            }
        });

        // Voice input functionality
        let recognition = null;
        let isRecording = false;

        function initializeVoiceInput() {
            if ('webkitSpeechRecognition' in window || 'SpeechRecognition' in window) {
                const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
                recognition = new SpeechRecognition();
                recognition.continuous = false;
                recognition.interimResults = false;
                recognition.lang = 'en-US';

                recognition.onstart = function() {
                    isRecording = true;
                    const micButton = document.getElementById('micButton');
                    const voiceStatus = document.getElementById('voiceStatus');
                    
                    micButton.classList.add('recording');
                    micButton.innerHTML = '🔴';
                    voiceStatus.style.display = 'block';
                    voiceStatus.textContent = 'Listening... Speak your question';
                };

                recognition.onresult = function(event) {
                    const transcript = event.results[0][0].transcript;
                    document.getElementById('questionInput').value = transcript;
                    
                    // Auto-resize the textarea
                    const textarea = document.getElementById('questionInput');
                    textarea.style.height = 'auto';
                    textarea.style.height = Math.min(textarea.scrollHeight, 140) + 'px';
                };

                recognition.onend = function() {
                    stopRecording();
                };

                recognition.onerror = function(event) {
                    console.error('Speech recognition error:', event.error);
                    const voiceStatus = document.getElementById('voiceStatus');
                    voiceStatus.textContent = 'Voice input not available. Please type your question.';
                    voiceStatus.style.color = '#ef4444';
                    setTimeout(() => {
                        voiceStatus.style.display = 'none';
                        voiceStatus.style.color = '#667eea';
                    }, 3000);
                    stopRecording();
                };
            } else {
                // Hide mic button if speech recognition not supported
                document.getElementById('micButton').style.display = 'none';
            }
        }

        function toggleVoiceInput() {
            if (!recognition) {
                alert('Voice input is not supported in your browser. Please type your question.');
                return;
            }

            if (isRecording) {
                recognition.stop();
            } else {
                recognition.start();
            }
        }

        function stopRecording() {
            isRecording = false;
            const micButton = document.getElementById('micButton');
            const voiceStatus = document.getElementById('voiceStatus');
            
            micButton.classList.remove('recording');
            micButton.innerHTML = '🎤';
            voiceStatus.style.display = 'none';
        }

        // Initialize app when page loads
        window.addEventListener('load', function() {
            initializeApp();
            initializeVoiceInput();
            document.getElementById('questionInput').focus();
        });

        // Close modal when clicking outside
        document.getElementById('donationModal').addEventListener('click', function(e) {
            if (e.target === this) {
                hideDonationModal();
            }
        });

        // Initialize PayPal button when modal opens
        function showDonationModal() {
            document.getElementById('donationModal').style.display = 'flex';
            
            // Reset the donation button display
            document.getElementById('donateButton').style.display = 'block';
            document.getElementById('paypal-container').innerHTML = '';
        }
    </script>

    <!-- PayPal SDK -->
    <script src="https://www.paypal.com/sdk/js?client-id=BAA6ecVThcHHKdcMOKrs79yXvNZ4Bv7hzG53kAr9ACEDFpBpRFT0HzxX4P8sEiH2EwU3L5RTOM78yiE3AY&components=hosted-buttons&enable-funding=venmo&currency=USD"></script>


    <script>
        function toggleDisclaimer() {
            const content = document.getElementById('disclaimerContent');
            const icon = document.getElementById('disclaimerIcon');
            
            if (content.style.display === 'none') {
                content.style.display = 'block';
                icon.textContent = '▲';
            } else {
                content.style.display = 'none';
                icon.textContent = '▼';
            }
        }
    </script>
</body>
</html>